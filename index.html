<!DOCTYPE html>
<html lang="en" data-theme="blueprint">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gantt Chart Editor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=JetBrains+Mono:wght@400;500&family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // Theme configurations
    const THEMES = {
      blueprint: {
        name: 'Architectural Blueprint',
        description: 'Professional and refined'
      },
      fun: {
        name: 'Fun & Vibrant',
        description: 'Playful and energetic'
      },
      traditional: {
        name: 'Traditional',
        description: 'Classic and familiar'
      },
      dark: {
        name: 'Dark Mode',
        description: 'Easy on the eyes'
      }
    };

    function GanttChartEditor() {
      const loadSaved = () => {
        try {
          const saved = localStorage.getItem('gantt-project');
          if (saved) return JSON.parse(saved);
        } catch (e) {}
        return null;
      };
      const saved = loadSaved();

      const [activities, setActivities] = useState(saved?.activities || []);
      const [name, setName] = useState('');
      const [duration, setDuration] = useState('');
      const [startDate, setStartDate] = useState(saved?.startDate || new Date().toISOString().split('T')[0]);
      const [draggedIndex, setDraggedIndex] = useState(null);
      const [dragOverIndex, setDragOverIndex] = useState(null);
      const [editingId, setEditingId] = useState(null);
      const [editForm, setEditForm] = useState({ name: '', duration: '', dependency: 'FS' });
      const [unitWidth, setUnitWidth] = useState(36);
      const [timeScale, setTimeScale] = useState('days');
      const [theme, setTheme] = useState(saved?.theme || 'blueprint');
      const [printMode, setPrintMode] = useState('chart'); // 'chart' or 'table'

      const timelineContainerRef = useRef(null);
      const fileInputRef = useRef(null);

      // Apply theme to document
      useEffect(() => {
        document.documentElement.setAttribute('data-theme', theme);
      }, [theme]);

      // Auto-save to localStorage
      useEffect(() => {
        localStorage.setItem('gantt-project', JSON.stringify({ startDate, activities, theme }));
      }, [activities, startDate, theme]);

      const saveToFile = () => {
        const data = {
          startDate,
          activities: activities.map(({ id, ...rest }) => rest)
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'gantt-project.json';
        a.click();
        URL.revokeObjectURL(url);
      };

      const loadFromFile = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const data = JSON.parse(event.target.result);
            if (data.startDate) setStartDate(data.startDate);
            if (data.activities && Array.isArray(data.activities)) {
              setActivities(data.activities.map((a, i) => ({ ...a, id: Date.now() + i })));
            }
          } catch (err) {
            alert('Invalid JSON file');
          }
        };
        reader.readAsText(file);
        e.target.value = '';
      };

      const clearAll = () => {
        if (activities.length === 0) return;
        if (confirm('Are you sure you want to clear all activities? This cannot be undone.')) {
          setActivities([]);
          setStartDate(new Date().toISOString().split('T')[0]);
        }
      };

      // Break long words (over 16 chars) to prevent layout issues
      const breakLongWords = (text) => {
        return text.split(' ').map(word => {
          if (word.length <= 16) return word;
          return word.match(/.{1,16}/g).join(' ');
        }).join(' ');
      };

      const addActivity = () => {
        if (name.trim() && duration >= 0 && duration !== '') {
          setActivities([...activities, {
            id: Date.now(),
            name: breakLongWords(name.trim().slice(0, 100)),
            duration: parseInt(duration),
            dependency: 'FS'
          }]);
          setName('');
          setDuration('');
        }
      };

      const removeActivity = (id) => {
        setActivities(activities.filter(a => a.id !== id));
        if (editingId === id) setEditingId(null);
      };

      const startEditing = (activity) => {
        setEditingId(activity.id);
        setEditForm({
          name: activity.name,
          duration: activity.duration.toString(),
          dependency: activity.dependency || 'FS'
        });
      };

      const saveEdit = () => {
        if (editForm.name.trim() && editForm.duration >= 0 && editForm.duration !== '') {
          setActivities(activities.map(a =>
            a.id === editingId
              ? { ...a, name: breakLongWords(editForm.name.trim().slice(0, 100)), duration: parseInt(editForm.duration), dependency: editForm.dependency }
              : a
          ));
          setEditingId(null);
        }
      };

      const cancelEdit = () => {
        setEditingId(null);
      };

      const handleDragStart = (e, index) => {
        if (editingId) return;
        setDraggedIndex(index);
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', e.target.outerHTML);
      };

      const handleDragOver = (e, index) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        if (index !== draggedIndex) {
          setDragOverIndex(index);
        }
      };

      const handleDragLeave = () => {
        setDragOverIndex(null);
      };

      const handleDrop = (e, dropIndex) => {
        e.preventDefault();
        if (draggedIndex === null || draggedIndex === dropIndex) {
          setDraggedIndex(null);
          setDragOverIndex(null);
          return;
        }

        const newActivities = [...activities];
        const [draggedItem] = newActivities.splice(draggedIndex, 1);
        newActivities.splice(dropIndex, 0, draggedItem);

        setActivities(newActivities);
        setDraggedIndex(null);
        setDragOverIndex(null);
      };

      const handleDragEnd = () => {
        setDraggedIndex(null);
        setDragOverIndex(null);
      };

      const addDays = (date, days) => {
        const result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
      };

      const formatDate = (date, format = 'short') => {
        if (format === 'short') {
          return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
        }
        if (format === 'withYear') {
          return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
        }
        return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
      };

      const projectStartDate = new Date(startDate);

      const calculateStartTimes = () => {
        const startTimes = [];
        for (let i = 0; i < activities.length; i++) {
          if (i === 0) {
            startTimes.push(0);
          } else {
            const prevStart = startTimes[i - 1];
            const prevDuration = activities[i - 1].duration;
            const currentDependency = activities[i].dependency || 'FS';

            if (currentDependency === 'SS') {
              startTimes.push(prevStart);
            } else {
              startTimes.push(prevStart + prevDuration);
            }
          }
        }
        return startTimes;
      };

      const startTimes = calculateStartTimes();

      const calculateTotalDuration = () => {
        if (activities.length === 0) return 0;
        let maxEnd = 0;
        for (let i = 0; i < activities.length; i++) {
          const end = startTimes[i] + activities[i].duration;
          if (end > maxEnd) maxEnd = end;
        }
        return maxEnd;
      };

      const totalDuration = calculateTotalDuration();

      const generateTimelineUnits = () => {
        if (totalDuration === 0) return { units: [], totalUnits: 14 };

        const endDate = addDays(projectStartDate, totalDuration);
        const units = [];

        if (timeScale === 'days') {
          const numDays = Math.max(totalDuration, 14);
          for (let i = 0; i < numDays; i++) {
            const date = addDays(projectStartDate, i);
            units.push({
              date,
              label: date.getDate().toString(),
              subLabel: date.toLocaleDateString('en-GB', { month: 'short' }),
              isWeekend: date.getDay() === 0 || date.getDay() === 6,
              isFirstOfPeriod: date.getDate() === 1
            });
          }
          return { units, totalUnits: numDays };
        }

        if (timeScale === 'weeks') {
          const numWeeks = Math.max(Math.ceil(totalDuration / 7), 4);
          for (let i = 0; i < numWeeks; i++) {
            const weekStart = addDays(projectStartDate, i * 7);
            units.push({
              date: weekStart,
              label: `W${i + 1}`,
              subLabel: `${weekStart.getDate()} ${weekStart.toLocaleDateString('en-GB', { month: 'short' })}`,
              isWeekend: false,
              isFirstOfPeriod: weekStart.getMonth() !== addDays(weekStart, -7).getMonth()
            });
          }
          return { units, totalUnits: numWeeks, daysPerUnit: 7 };
        }

        if (timeScale === 'months') {
          const startYear = projectStartDate.getFullYear();
          const startMonth = projectStartDate.getMonth();
          const endYear = endDate.getFullYear();
          const endMonth = endDate.getMonth();

          const numMonths = Math.max((endYear - startYear) * 12 + (endMonth - startMonth) + 1, 3);

          for (let i = 0; i < numMonths; i++) {
            const monthDate = new Date(startYear, startMonth + i, 1);
            const daysInMonth = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0).getDate();
            units.push({
              date: monthDate,
              label: monthDate.toLocaleDateString('en-GB', { month: 'short' }),
              subLabel: monthDate.getFullYear().toString(),
              isWeekend: false,
              isFirstOfPeriod: monthDate.getMonth() === 0,
              daysInMonth
            });
          }
          return { units, totalUnits: numMonths, scale: 'months' };
        }

        return { units: [], totalUnits: 14 };
      };

      const { units: timelineUnits, totalUnits } = generateTimelineUnits();
      const timelineWidth = totalUnits * unitWidth;

      const getBarPosition = (startDay, durationDays) => {
        if (timeScale === 'days') {
          return {
            left: startDay * unitWidth + 2,
            width: Math.max(durationDays * unitWidth - 4, 4)
          };
        }

        if (timeScale === 'weeks') {
          const startWeek = startDay / 7;
          const durationWeeks = durationDays / 7;
          return {
            left: startWeek * unitWidth + 2,
            width: Math.max(durationWeeks * unitWidth - 4, 4)
          };
        }

        if (timeScale === 'months') {
          const activityStart = addDays(projectStartDate, startDay);
          const activityEnd = addDays(projectStartDate, startDay + durationDays - 1);

          let leftOffset = 0;
          let barWidth = 0;
          let foundStart = false;

          for (let i = 0; i < timelineUnits.length; i++) {
            const unit = timelineUnits[i];
            const monthStart = unit.date;
            const monthEnd = new Date(monthStart.getFullYear(), monthStart.getMonth() + 1, 0);
            const daysInMonth = unit.daysInMonth;

            if (!foundStart) {
              if (activityStart <= monthEnd) {
                foundStart = true;
                const dayInMonth = activityStart >= monthStart
                  ? activityStart.getDate() - 1
                  : 0;
                leftOffset = i * unitWidth + (dayInMonth / daysInMonth) * unitWidth;
              }
            }

            if (foundStart) {
              if (activityEnd <= monthEnd) {
                const endDayInMonth = activityEnd >= monthStart
                  ? activityEnd.getDate()
                  : 0;
                const startDayInMonth = activityStart >= monthStart && activityStart <= monthEnd
                  ? activityStart.getDate() - 1
                  : 0;

                if (activityStart >= monthStart) {
                  barWidth = ((endDayInMonth - startDayInMonth) / daysInMonth) * unitWidth;
                } else {
                  barWidth += (endDayInMonth / daysInMonth) * unitWidth;
                }
                break;
              } else {
                if (activityStart >= monthStart && activityStart <= monthEnd) {
                  const startDayInMonth = activityStart.getDate() - 1;
                  barWidth += ((daysInMonth - startDayInMonth) / daysInMonth) * unitWidth;
                } else {
                  barWidth += unitWidth;
                }
              }
            }
          }

          return {
            left: leftOffset + 2,
            width: Math.max(barWidth - 4, 4)
          };
        }

        return { left: 0, width: 0 };
      };

      // Bar color classes
      const barColors = ['bar-1', 'bar-2', 'bar-3', 'bar-4', 'bar-5', 'bar-6'];

      // Get CSS variable value for fill colors
      const getFillColor = (index) => {
        const colors = {
          blueprint: ['#64748b', '#84a98c', '#c9a96e', '#c9a9a6', '#94a3b8', '#d4a574'],
          fun: ['#f472b6', '#a78bfa', '#60a5fa', '#34d399', '#fbbf24', '#fb923c'],
          traditional: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#6f42c1', '#fd7e14'],
          dark: ['#6366f1', '#22c55e', '#f59e0b', '#ec4899', '#06b6d4', '#8b5cf6']
        };
        return colors[theme]?.[index % 6] || colors.blueprint[index % 6];
      };

      const suggestScale = () => {
        if (totalDuration <= 60) return 'days';
        if (totalDuration <= 180) return 'weeks';
        return 'months';
      };

      const fitToView = () => {
        if (timelineContainerRef.current && totalUnits > 0) {
          const containerWidth = timelineContainerRef.current.offsetWidth - 20;
          const newUnitWidth = Math.max(20, Math.floor(containerWidth / totalUnits));
          setUnitWidth(Math.min(newUnitWidth, 80));
        }
      };

      const handlePrint = () => {
        window.print();
      };

      const autoScale = () => {
        const suggested = suggestScale();
        setTimeScale(suggested);
        if (suggested === 'days') setUnitWidth(36);
        else if (suggested === 'weeks') setUnitWidth(60);
        else setUnitWidth(80);
      };

      // Icon components
      const IconGrip = () => (
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" opacity="0.4">
          <circle cx="8" cy="6" r="2"/><circle cx="16" cy="6" r="2"/>
          <circle cx="8" cy="12" r="2"/><circle cx="16" cy="12" r="2"/>
          <circle cx="8" cy="18" r="2"/><circle cx="16" cy="18" r="2"/>
        </svg>
      );

      const IconEdit = () => (
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
        </svg>
      );

      const IconCheck = () => (
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
      );

      const IconX = () => (
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      );

      const IconDownload = () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
      );

      const IconUpload = () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
      );

      const IconPrinter = () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/>
        </svg>
      );

      const IconTrash = () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
        </svg>
      );

      const IconPlus = () => (
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
      );

      const IconPalette = () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/>
          <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/>
        </svg>
      );

      return (
        <div className="min-h-screen p-6 md:p-8">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="no-print mb-8 animate-fade-in">
              <div className="flex items-center justify-between flex-wrap gap-4">
                <div className="flex items-center gap-3">
                  <div className="app-header-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                      <rect x="3" y="4" width="18" height="4" rx="1"/><rect x="3" y="10" width="12" height="4" rx="1"/><rect x="3" y="16" width="15" height="4" rx="1"/>
                    </svg>
                  </div>
                  <div>
                    <h1 className="text-2xl font-semibold text-primary tracking-tight">Gantt Chart</h1>
                    <p className="text-sm text-muted">Plan and visualize your project timeline</p>
                  </div>
                </div>

                {/* Theme Selector */}
                <div className="theme-selector">
                  <IconPalette />
                  <label>Theme</label>
                  <select
                    value={theme}
                    onChange={(e) => setTheme(e.target.value)}
                    className="select-refined"
                  >
                    {Object.entries(THEMES).map(([key, value]) => (
                      <option key={key} value={key}>{value.name}</option>
                    ))}
                  </select>
                </div>
              </div>
            </div>

            {/* Add Activity Form */}
            <div className="no-print card p-5 mb-6 animate-fade-in" style={{ animationDelay: '0.05s' }}>
              <div className="flex flex-wrap gap-4 items-end">
                <div className="flex-shrink-0">
                  <label className="block text-xs font-medium text-muted uppercase tracking-wider mb-2">Project Start</label>
                  <input
                    type="date"
                    value={startDate}
                    onChange={(e) => setStartDate(e.target.value)}
                    className="input-refined w-40"
                  />
                </div>
                <div className="flex-1 min-w-[280px]">
                  <label className="block text-xs font-medium text-muted uppercase tracking-wider mb-2">Activity Name</label>
                  <input
                    type="text"
                    placeholder="Enter activity description..."
                    value={name}
                    onChange={(e) => setName(e.target.value)}
                    onKeyDown={(e) => e.key === 'Enter' && addActivity()}
                    maxLength={100}
                    className="input-refined w-full"
                  />
                </div>
                <div className="w-28">
                  <label className="block text-xs font-medium text-muted uppercase tracking-wider mb-1">Duration</label>
                  <p className="text-[10px] text-faint mb-1 text-center">0 = milestone</p>
                  <input
                    type="number"
                    placeholder="Days"
                    value={duration}
                    onChange={(e) => setDuration(e.target.value)}
                    onKeyDown={(e) => e.key === 'Enter' && addActivity()}
                    min="0"
                    className="input-refined w-full text-center font-mono"
                    title="Enter 0 for a milestone"
                  />
                </div>
                <button onClick={addActivity} className="btn btn-accent">
                  <IconPlus /> Add Activity
                </button>
              </div>
            </div>

            {/* Toolbar */}
            <div className="no-print card p-4 mb-6 animate-fade-in" style={{ animationDelay: '0.1s' }}>
              <div className="flex flex-wrap items-center gap-3">
                <div className="flex items-center gap-2">
                  <span className="text-xs font-medium text-muted uppercase tracking-wider">Scale</span>
                  <select
                    value={timeScale}
                    onChange={(e) => {
                      setTimeScale(e.target.value);
                      if (e.target.value === 'days') setUnitWidth(36);
                      else if (e.target.value === 'weeks') setUnitWidth(60);
                      else setUnitWidth(80);
                    }}
                    className="select-refined"
                  >
                    <option value="days">Days</option>
                    <option value="weeks">Weeks</option>
                    <option value="months">Months</option>
                  </select>
                  <button onClick={autoScale} className="btn btn-secondary btn-sm" title="Auto-select best scale">
                    Auto
                  </button>
                </div>

                <div className="divider"></div>

                <div className="flex items-center gap-2">
                  <span className="text-xs font-medium text-muted uppercase tracking-wider">Zoom</span>
                  <input
                    type="range"
                    min="20"
                    max="100"
                    value={unitWidth}
                    onChange={(e) => setUnitWidth(parseInt(e.target.value))}
                    className="w-24"
                  />
                  <button onClick={fitToView} className="btn btn-secondary btn-sm">
                    Fit
                  </button>
                </div>

                <div className="flex-1"></div>

                <div className="flex items-center gap-2">
                  <span className="text-xs font-medium text-muted uppercase tracking-wider">Print as</span>
                  <select
                    value={printMode}
                    onChange={(e) => setPrintMode(e.target.value)}
                    className="select-refined"
                  >
                    <option value="chart">Chart</option>
                    <option value="table">Table</option>
                  </select>
                  <button onClick={handlePrint} className="btn btn-secondary btn-sm">
                    <IconPrinter /> Print
                  </button>
                  <button onClick={saveToFile} className="btn btn-secondary btn-sm">
                    <IconDownload /> Save
                  </button>
                  <button onClick={() => fileInputRef.current.click()} className="btn btn-secondary btn-sm">
                    <IconUpload /> Open
                  </button>
                  <input
                    type="file"
                    ref={fileInputRef}
                    onChange={loadFromFile}
                    accept=".json"
                    className="hidden"
                  />
                  <button onClick={clearAll} className="btn btn-danger btn-sm" title="Clear all activities">
                    <IconTrash /> Clear
                  </button>
                </div>
              </div>
            </div>

            {/* Gantt Chart */}
            {activities.length === 0 ? (
              <div className="card empty-state no-print animate-fade-in" style={{ animationDelay: '0.15s' }}>
                <div className="empty-state-icon">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-faint">
                    <rect x="3" y="4" width="18" height="4" rx="1"/><rect x="3" y="10" width="12" height="4" rx="1"/><rect x="3" y="16" width="15" height="4" rx="1"/>
                  </svg>
                </div>
                <p className="text-secondary font-medium mb-1">No activities yet</p>
                <p className="text-faint text-sm">Add your first activity above to start building your timeline</p>
              </div>
            ) : (
              <div className="gantt-print-area animate-fade-in" style={{ animationDelay: '0.15s' }}>
                <div className="print-title hidden mb-4">
                  <h1 className="text-xl font-semibold text-primary">Project Gantt Chart</h1>
                  <p className="text-sm text-muted">
                    {formatDate(projectStartDate, 'withYear')} — {formatDate(addDays(projectStartDate, totalDuration - 1), 'withYear')} ({totalDuration} days)
                  </p>
                </div>

                {/* Screen layout (flex-based) - hidden during print, replaced by table for repeating headers */}
                <div className="card overflow-hidden gantt-screen-only">
                  {/* Header Row */}
                  <div className="flex gantt-header">
                    <div className="flex-shrink-0 flex">
                      <div className="w-10 px-2 py-3 gantt-cell no-print"></div>
                      <div className="w-64 px-4 py-3 font-medium text-xs text-muted uppercase tracking-wider gantt-cell">Activity</div>
                      <div className="w-16 px-2 py-3 font-medium text-xs text-muted uppercase tracking-wider gantt-cell text-center">Days</div>
                      <div className="w-14 px-2 py-3 font-medium text-xs text-muted uppercase tracking-wider gantt-cell text-center">Type</div>
                    </div>
                    <div className="flex-1 px-3 py-3 font-medium text-xs text-muted uppercase tracking-wider">
                      Timeline <span className="lowercase font-normal">({timeScale})</span>
                    </div>
                  </div>

                  {/* Timeline Header Row */}
                  <div className="flex border-b border-primary">
                    <div className="flex-shrink-0 flex bg-secondary h-12" style={{ opacity: 0.5 }}>
                      <div className="w-10 gantt-cell no-print"></div>
                      <div className="w-64 gantt-cell"></div>
                      <div className="w-16 gantt-cell"></div>
                      <div className="w-14 gantt-cell"></div>
                    </div>
                    <div className="flex-1 overflow-x-auto custom-scroll" ref={timelineContainerRef}>
                      <div className="flex text-xs h-12" style={{ width: timelineWidth, minWidth: '100%', background: 'var(--bg-secondary)', opacity: 0.5 }}>
                        {timelineUnits.map((unit, i) => (
                          <div
                            key={i}
                            className={`timeline-unit text-center flex flex-col justify-center
                              ${unit.isWeekend ? 'weekend' : ''}
                              ${unit.isFirstOfPeriod ? 'first-of-period' : ''}`}
                            style={{ width: unitWidth, minWidth: unitWidth }}
                          >
                            <div className="font-medium text-secondary leading-tight truncate px-0.5">{unit.label}</div>
                            <div className="text-faint text-[10px] truncate leading-tight px-0.5">{unit.subLabel}</div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  {/* Activity Rows */}
                  {activities.map((activity, index) => {
                    const isDragging = draggedIndex === index;
                    const isDragOver = dragOverIndex === index;
                    const isEditing = editingId === activity.id;
                    const start = startTimes[index];
                    const barColor = barColors[index % barColors.length];
                    const activityStartDate = addDays(projectStartDate, start);
                    const activityEndDate = addDays(projectStartDate, start + activity.duration - 1);
                    const barPos = getBarPosition(start, activity.duration);

                    return (
                      <div
                        key={activity.id}
                        draggable={!isEditing}
                        onDragStart={(e) => handleDragStart(e, index)}
                        onDragOver={(e) => handleDragOver(e, index)}
                        onDragLeave={handleDragLeave}
                        onDrop={(e) => handleDrop(e, index)}
                        onDragEnd={handleDragEnd}
                        className={`
                          flex gantt-row animate-slide-in
                          ${isDragging ? 'dragging' : ''}
                          ${isDragOver ? 'drag-over' : ''}
                          ${isEditing ? 'editing' : ''}
                        `}
                        style={{ animationDelay: `${index * 0.03}s` }}
                      >
                        {/* Left side - Activity info */}
                        <div className="flex-shrink-0 flex min-h-14">
                          <div className="w-10 px-2 gantt-cell flex items-center justify-center cursor-grab active:cursor-grabbing no-print text-faint hover:text-secondary transition-colors">
                            <IconGrip />
                          </div>

                          {isEditing ? (
                            <>
                              <div className="w-64 px-3 py-2 gantt-cell flex items-center gap-2 no-print">
                                <input
                                  type="text"
                                  value={editForm.name}
                                  onChange={(e) => setEditForm({...editForm, name: e.target.value})}
                                  maxLength={100}
                                  className="input-refined flex-1 py-1.5 text-sm"
                                  autoFocus
                                />
                                <button onClick={saveEdit} className="p-1.5 text-green-600 hover:text-green-700 hover:bg-green-50 rounded transition-colors" title="Save">
                                  <IconCheck />
                                </button>
                                <button onClick={cancelEdit} className="p-1.5 text-red-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors" title="Cancel">
                                  <IconX />
                                </button>
                              </div>
                              <div className="w-16 px-1 gantt-cell flex items-center no-print">
                                <input
                                  type="number"
                                  value={editForm.duration}
                                  onChange={(e) => setEditForm({...editForm, duration: e.target.value})}
                                  min="0"
                                  className="input-refined w-full py-1.5 text-sm text-center font-mono"
                                />
                              </div>
                              <div className="w-14 px-1 gantt-cell flex items-center no-print">
                                <select
                                  value={editForm.dependency}
                                  onChange={(e) => setEditForm({...editForm, dependency: e.target.value})}
                                  className="select-refined w-full py-1.5 text-xs"
                                  style={{ paddingRight: '24px' }}
                                >
                                  <option value="FS">FS</option>
                                  <option value="SS">SS</option>
                                </select>
                              </div>
                            </>
                          ) : (
                            <>
                              <div className="w-64 px-4 py-3 gantt-cell flex items-start justify-between group">
                                <span className="text-sm text-primary leading-snug break-words pr-2">{activity.name}</span>
                                <div className="flex items-center gap-0.5 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity no-print">
                                  <button onClick={() => startEditing(activity)} className="p-1.5 text-faint hover:text-secondary rounded transition-colors" title="Edit">
                                    <IconEdit />
                                  </button>
                                  <button onClick={() => removeActivity(activity.id)} className="p-1.5 text-faint hover:text-red-500 rounded transition-colors" title="Delete">
                                    <IconX />
                                  </button>
                                </div>
                              </div>
                              <div className="w-16 px-2 gantt-cell text-center text-secondary flex items-center justify-center font-mono text-sm">
                                {activity.duration}
                              </div>
                              <div className="w-14 px-2 gantt-cell flex items-center justify-center">
                                <span className={`tag ${activity.dependency === 'SS' ? 'tag-ss' : 'tag-fs'}`}>
                                  {activity.dependency || 'FS'}
                                </span>
                              </div>
                            </>
                          )}
                        </div>

                        {/* Right side - Timeline bar */}
                        <div className="flex-1 relative min-h-14 overflow-hidden">
                          <div className="absolute inset-0 flex">
                            {timelineUnits.map((unit, i) => (
                              <div
                                key={i}
                                className={`timeline-unit h-full ${unit.isWeekend ? 'weekend' : ''}`}
                                style={{ width: unitWidth, minWidth: unitWidth, borderColor: 'var(--border-secondary)' }}
                              />
                            ))}
                          </div>
                          <div className="absolute inset-y-0 flex items-center" style={{ left: barPos.left }}>
                            {activity.duration === 0 ? (
                              <svg
                                width="18"
                                height="18"
                                viewBox="0 0 20 20"
                                style={{ marginLeft: '-9px' }}
                                title={`${activity.name}: ${formatDate(activityStartDate, 'withYear')} (Milestone)`}
                                className="drop-shadow-sm"
                              >
                                <polygon
                                  points="10,1 19,10 10,19 1,10"
                                  fill={getFillColor(index)}
                                  stroke="white"
                                  strokeWidth="1.5"
                                />
                              </svg>
                            ) : (
                              <div
                                className={`${barColor} activity-bar h-7 text-white text-xs flex items-center justify-center`}
                                style={{ width: barPos.width }}
                                title={`${activity.name}: ${formatDate(activityStartDate, 'withYear')} - ${formatDate(activityEndDate, 'withYear')} (${activity.duration} days)`}
                              >
                                {barPos.width > 130 && (
                                  <span className="px-2 truncate font-medium text-[11px] tracking-tight opacity-95">
                                    {formatDate(activityStartDate)} — {formatDate(activityEndDate)}
                                  </span>
                                )}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    );
                  })}

                  {/* Footer Row */}
                  <div className="flex gantt-header h-12">
                    <div className="flex-shrink-0 flex">
                      <div className="w-10 gantt-cell no-print"></div>
                      <div className="w-64 px-4 font-medium text-secondary text-sm gantt-cell flex items-center">
                        Total Duration
                      </div>
                      <div className="w-16 px-2 font-semibold text-primary gantt-cell flex items-center justify-center font-mono">
                        {totalDuration}
                      </div>
                      <div className="w-14 gantt-cell"></div>
                    </div>
                    <div className="flex-1 px-4 flex items-center text-sm text-muted">
                      {activities.length > 0 && (
                        <span>
                          {formatDate(projectStartDate, 'withYear')} — {formatDate(addDays(projectStartDate, totalDuration - 1), 'withYear')}
                        </span>
                      )}
                    </div>
                  </div>
                </div>

                {/* Print layout - TABLE MODE (simple list with dates) */}
                <table className={`gantt-print-table ${printMode === 'table' ? 'gantt-print-only' : 'hidden'}`}>
                  <thead className="gantt-print-thead">
                    <tr className="gantt-print-row">
                      <th className="gantt-print-header-cell" style={{ width: '45%' }}>Activity</th>
                      <th className="gantt-print-header-cell" style={{ width: '10%', textAlign: 'center' }}>Days</th>
                      <th className="gantt-print-header-cell" style={{ width: '10%', textAlign: 'center' }}>Type</th>
                      <th className="gantt-print-header-cell" style={{ width: '35%' }}>Dates</th>
                    </tr>
                  </thead>
                  <tbody className="gantt-print-tbody">
                    {activities.map((activity, index) => {
                      const start = startTimes[index];
                      const activityStartDate = addDays(projectStartDate, start);
                      const activityEndDate = addDays(projectStartDate, start + activity.duration - 1);
                      return (
                        <tr key={activity.id} className="gantt-print-row">
                          <td className="gantt-print-cell">
                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                              {activity.duration === 0 ? (
                                <svg width="14" height="14" viewBox="0 0 20 20">
                                  <polygon points="10,1 19,10 10,19 1,10" fill={getFillColor(index)}/>
                                </svg>
                              ) : (
                                <div style={{
                                  width: '14px',
                                  height: '14px',
                                  borderRadius: '3px',
                                  background: getFillColor(index)
                                }}></div>
                              )}
                              <span>{activity.name}</span>
                            </div>
                          </td>
                          <td className="gantt-print-cell" style={{ textAlign: 'center', fontFamily: 'var(--font-mono)' }}>
                            {activity.duration}
                          </td>
                          <td className="gantt-print-cell" style={{ textAlign: 'center' }}>
                            <span className={`tag ${activity.dependency === 'SS' ? 'tag-ss' : 'tag-fs'}`}>
                              {activity.dependency || 'FS'}
                            </span>
                          </td>
                          <td className="gantt-print-cell">
                            {activity.duration === 0
                              ? formatDate(activityStartDate, 'withYear') + ' (Milestone)'
                              : `${formatDate(activityStartDate, 'withYear')} — ${formatDate(activityEndDate, 'withYear')}`
                            }
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                  <tfoot className="gantt-print-tfoot">
                    <tr className="gantt-print-row">
                      <td className="gantt-print-cell" style={{ fontWeight: '600' }}>Total Duration</td>
                      <td className="gantt-print-cell" style={{ textAlign: 'center', fontWeight: '700', fontFamily: 'var(--font-mono)' }}>{totalDuration}</td>
                      <td className="gantt-print-cell"></td>
                      <td className="gantt-print-cell">
                        {formatDate(projectStartDate, 'withYear')} — {formatDate(addDays(projectStartDate, totalDuration - 1), 'withYear')}
                      </td>
                    </tr>
                  </tfoot>
                </table>

                {/* Print layout - CHART MODE (visual bars with repeating timeline headers) */}
                <table className={`gantt-chart-print-table ${printMode === 'chart' ? 'gantt-chart-print-only' : 'hidden'}`}>
                  <thead className="gantt-print-thead">
                    <tr className="gantt-print-row">
                      <th className="gantt-print-header-cell" style={{ width: '200px', minWidth: '200px' }}>Activity</th>
                      <th className="gantt-print-header-cell" style={{ width: '50px', minWidth: '50px', textAlign: 'center' }}>Days</th>
                      <th className="gantt-print-header-cell" style={{ width: '50px', minWidth: '50px', textAlign: 'center' }}>Type</th>
                      <th className="gantt-print-header-cell gantt-timeline-header-cell" style={{ padding: 0 }}>
                        <div style={{ display: 'flex', width: timelineWidth, minWidth: '100%' }}>
                          {timelineUnits.map((unit, i) => (
                            <div
                              key={i}
                              style={{
                                width: unitWidth,
                                minWidth: unitWidth,
                                textAlign: 'center',
                                padding: '6px 0',
                                borderRight: '1px solid var(--border-secondary)',
                                background: unit.isWeekend ? 'var(--bg-weekend)' : 'var(--bg-secondary)'
                              }}
                            >
                              <div style={{ fontWeight: 500, fontSize: '10px', lineHeight: 1.2 }}>{unit.label}</div>
                              <div style={{ fontSize: '9px', color: 'var(--text-faint)', lineHeight: 1.2 }}>{unit.subLabel}</div>
                            </div>
                          ))}
                        </div>
                      </th>
                    </tr>
                  </thead>
                  <tbody className="gantt-print-tbody">
                    {activities.map((activity, index) => {
                      const start = startTimes[index];
                      const activityStartDate = addDays(projectStartDate, start);
                      const activityEndDate = addDays(projectStartDate, start + activity.duration - 1);
                      const barPos = getBarPosition(start, activity.duration);
                      return (
                        <tr key={activity.id} className="gantt-print-row">
                          <td className="gantt-print-cell" style={{ width: '200px', minWidth: '200px' }}>
                            <span style={{ fontSize: '12px' }}>{activity.name}</span>
                          </td>
                          <td className="gantt-print-cell" style={{ width: '50px', minWidth: '50px', textAlign: 'center', fontFamily: 'var(--font-mono)', fontSize: '12px' }}>
                            {activity.duration}
                          </td>
                          <td className="gantt-print-cell" style={{ width: '50px', minWidth: '50px', textAlign: 'center' }}>
                            <span className={`tag ${activity.dependency === 'SS' ? 'tag-ss' : 'tag-fs'}`}>
                              {activity.dependency || 'FS'}
                            </span>
                          </td>
                          <td className="gantt-print-cell gantt-timeline-cell" style={{ padding: 0, position: 'relative', height: '36px' }}>
                            {/* Timeline grid background */}
                            <div style={{ display: 'flex', position: 'absolute', inset: 0, width: timelineWidth }}>
                              {timelineUnits.map((unit, i) => (
                                <div
                                  key={i}
                                  style={{
                                    width: unitWidth,
                                    minWidth: unitWidth,
                                    height: '100%',
                                    borderRight: '1px solid var(--border-secondary)',
                                    background: unit.isWeekend ? 'var(--bg-weekend)' : 'transparent'
                                  }}
                                />
                              ))}
                            </div>
                            {/* Activity bar */}
                            <div style={{ position: 'absolute', top: '50%', transform: 'translateY(-50%)', left: barPos.left }}>
                              {activity.duration === 0 ? (
                                <svg width="14" height="14" viewBox="0 0 20 20" style={{ marginLeft: '-7px' }}>
                                  <polygon points="10,1 19,10 10,19 1,10" fill={getFillColor(index)}/>
                                </svg>
                              ) : (
                                <div
                                  style={{
                                    width: barPos.width,
                                    height: '20px',
                                    background: getFillColor(index),
                                    borderRadius: 'var(--radius-md)',
                                    boxShadow: 'var(--shadow-bar)'
                                  }}
                                />
                              )}
                            </div>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                  <tfoot className="gantt-print-tfoot">
                    <tr className="gantt-print-row">
                      <td className="gantt-print-cell" style={{ fontWeight: '600', fontSize: '12px' }}>Total: {totalDuration} days</td>
                      <td className="gantt-print-cell" colSpan="3" style={{ fontSize: '11px', color: 'var(--text-muted)' }}>
                        {formatDate(projectStartDate, 'withYear')} — {formatDate(addDays(projectStartDate, totalDuration - 1), 'withYear')}
                      </td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            )}

            {/* Legend */}
            <div className="mt-5 flex flex-wrap items-center gap-4 text-xs text-muted no-print animate-fade-in" style={{ animationDelay: '0.2s' }}>
              <span className="font-medium text-secondary uppercase tracking-wider">Legend</span>
              <div className="flex items-center gap-1.5">
                <span className="tag tag-fs">FS</span>
                <span>Finish-to-Start</span>
              </div>
              <div className="flex items-center gap-1.5">
                <span className="tag tag-ss">SS</span>
                <span>Start-to-Start</span>
              </div>
              <div className="flex items-center gap-1.5">
                <svg width="12" height="12" viewBox="0 0 20 20">
                  <polygon points="10,1 19,10 10,19 1,10" fill={getFillColor(0)}/>
                </svg>
                <span>Milestone</span>
              </div>
              {timeScale === 'days' && (
                <div className="flex items-center gap-1.5">
                  <div className="w-4 h-4 rounded weekend" style={{ background: 'var(--bg-weekend)', border: '1px solid var(--border-primary)' }}></div>
                  <span>Weekend</span>
                </div>
              )}
            </div>

            {/* Footer */}
            <div className="mt-8 pt-6 border-t text-center text-xs text-faint no-print animate-fade-in" style={{ animationDelay: '0.25s', borderColor: 'var(--border-primary)' }}>
              <p>Drag rows to reorder • Click activity to edit • Data auto-saves to browser</p>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<GanttChartEditor />);
  </script>
</body>
</html>
